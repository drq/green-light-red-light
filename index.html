<!DOCTYPE html>
<html lang="en">
<head>
    <title>Green Light - Red Light</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="initial-scale=1, width=device-width"/>
    <script
            src="https://unpkg.com/react@latest/umd/react.development.js"
            crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/react-dom@latest/umd/react-dom.development.js"></script>
    <script
            src="https://unpkg.com/@mui/material@latest/umd/material-ui.development.js"
            crossorigin="anonymous"
    ></script>
    <script
            src="https://unpkg.com/@babel/standalone@latest/babel.min.js"
            crossorigin="anonymous"
    ></script>
    <!-- Fonts to support Material Design -->
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap"
    />
    <!-- Icons to support Material Design -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
    const {
        colors,
        CssBaseline,
        ThemeProvider,
        Typography,
        Container,
        createTheme,
        Grid,
        Stack,
        Avatar,
        Icon,
        Button
    } = MaterialUI;

    // Create a theme instance.
    const theme = createTheme({
        palette: {
            primary: {
                main: '#556cd6',
            },
            secondary: {
                main: '#19857b',
            },
            error: {
                main: colors.red.A400,
            },
        },
    });

    const getRandomInt = (min, max) => {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min) + min); // The maximum is exclusive and the minimum is inclusive
    }

    function App() {
        const [light, setLight] = window.React.useState('red');
        const [gap, setGap] = window.React.useState(getRandomInt(3, 10) * 1000);
        const [score1, setScore1] = window.React.useState(null);
        const [score2, setScore2] = window.React.useState(null);

        const changeColorJob = setTimeout(() => {
            setLight(light === "green" ? "red" : "green")
        }, gap);

        window.React.useEffect(() => {
            document.addEventListener("keyup", (event) => {
                const key = event.key;
                const trafficLightElem = document.getElementById("traffic-light");
                const currentLight = trafficLightElem.getAttribute("data-light")
                const currentTimestamp = trafficLightElem.getAttribute("data-timestamp")
                if (key === 'a' && currentLight === 'green') {
                    setScore1(new Date().getTime() - currentTimestamp);
                }
                if (key === 'l' && currentLight === 'green') {
                    setScore2(new Date().getTime() - currentTimestamp);
                }
            });
        }, []);

        window.React.useEffect(() => {
            if (light === "red") {
                const trafficLightElem = document.getElementById("traffic-light");
                trafficLightElem.setAttribute("data-timestamp", new Date().getTime())
            }
        }, [light]);

            return (
            <Container>
                <Typography variant="h4" component="h1" sx={{
                    textAlign: "center",
                    margin: "48px"
                }}>
                    Green Light - Red Light
                </Typography>
                <Stack
                    direction="column"
                    justifyContent="center"
                    alignItems="center"
                    spacing={6}
                    sx={{
                        height: "50vh"
                    }}>
                    <Avatar
                        id="traffic-light"
                        data-light={light}
                        sx={{
                            width: 128, height: 128,
                            backgroundColor: `${light}`
                        }}>
                        <Icon>traffic</Icon>
                    </Avatar>
                    <Grid container
                          spacing={2}
                          direction="row"
                          justifyContent="center"
                          alignItems="center">
                        <Grid item xs={6} textAlign="center">
                            <Avatar src={"/image/bear.jpeg"}/>: {score1 || <Typography variant="h4" component="h2">{score1}</Typography>}
                        </Grid>
                        <Grid item xs={6} textAlign="center">
                            Baba: {score2 || <Typography variant="h4" component="h2">{score2}</Typography>}
                        </Grid>
                    </Grid>
                    <Button variant="contained" color="error" size="large" onClick={() => {
                        clearTimeout(changeColorJob);
                    }}>
                        Stop
                    </Button>
                </Stack>
            </Container>
        );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(
        <ThemeProvider theme={theme}>
            {/* CssBaseline kickstart an elegant, consistent, and simple baseline to build upon. */}
            <CssBaseline/>
            <App/>
        </ThemeProvider>,
    );
</script>
</body>
</html>